{
  "comments": [
    {
      "key": {
        "uuid": "1adf8d57_7d901596",
        "filename": "templates/scripts/includes/deployment.sh",
        "patchSetId": 1
      },
      "lineNbr": 1062,
      "author": {
        "id": 1000001
      },
      "writtenOn": "2018-11-30T14:47:29Z",
      "side": 1,
      "message": "I would vote for something like\n  \nget_pvdevice() {\n  local blockdevice\u003d$1\n\n  if [ -z \"${blockdevice}\" ]; then\n    echo \"error die....\" \u003e\u00262\n    exit 1\n  fi\n\n  local loop\u003d5\n  local pvdevice\u003d\"\"\n\n  while [ $loop -ne 0 ]; do\n    pvdevice\u003d$(blkid -t PARTLABEL\u003d\"Linux LVM\" -o device \"${blockdevice}\"* || true)\n    if [ -n \"${pvdevice}\" ]; then\n      break\n    else\n      echo \"pvdevice not yet available, retrying further $loop times\"\n      sleep 1\n    fi\n  done\n\n  if [ -z \"${pvdevice}\" ]; then\n    echo \"error die....\" \u003e\u00262\n    exit 1\n  fi\n\n  echo \"${pvdevice}\"\n}\n\n...\n\npvdevice\u003d$(get_pvdevice \"${blockdevice}\")",
      "range": {
        "startLine": 1062,
        "startChar": 0,
        "endLine": 1062,
        "endChar": 72
      },
      "revId": "2be8ae8b5d69ab2f9950730b0e22ea6f6b8a61bc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1adf8d57_3de96d1b",
        "filename": "templates/scripts/includes/deployment.sh",
        "patchSetId": 1
      },
      "lineNbr": 1062,
      "author": {
        "id": 1000001
      },
      "writtenOn": "2018-11-30T14:50:06Z",
      "side": 1,
      "message": "Oups, there is a mess with STDOUT, better...\n\nwait_for_pvdevice() {\n  local blockdevice\u003d$1\n\n  if [ -z \"${blockdevice}\" ]; then\n    echo \"error die....\" \u003e\u00262\n    exit 1\n  fi\n\n  local loop\u003d5\n  local pvdevice\u003d\"\"\n\n  while [ ${loop} -ne 0 ]; do\n    pvdevice\u003d$(blkid -t PARTLABEL\u003d\"Linux LVM\" -o device \"${blockdevice}\"* || true)\n    if [ -n \"${pvdevice}\" ]; then\n      echo \"pvdevice is available: ${pvdevice}\"\n      break\n    else\n      echo \"pvdevice not yet available, retrying further $loop times\"\n      sleep 1\n    fi\n  done\n\n  if [ -z \"${pvdevice}\" ]; then\n    echo \"error die....\" \u003e\u00262\n    exit 1\n  fi\n}\n\n...\n\nblockdev --flushbufs \"${blockdevice}\"\nwait_for_pvdevice \"${blockdevice}\"\npvdevice\u003d$(blkid -t PARTLABEL\u003d\"Linux LVM\" -o device \"${blockdevice}\"*)",
      "parentUuid": "1adf8d57_7d901596",
      "range": {
        "startLine": 1062,
        "startChar": 0,
        "endLine": 1062,
        "endChar": 72
      },
      "revId": "2be8ae8b5d69ab2f9950730b0e22ea6f6b8a61bc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1adf8d57_fdc9a5ad",
        "filename": "templates/scripts/includes/deployment.sh",
        "patchSetId": 1
      },
      "lineNbr": 1062,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2018-11-30T15:03:56Z",
      "side": 1,
      "message": "\u003e I would vote for something like\n\nTBH I prefer a single line and waiting just 3 seconds than adding 20 lines of code.",
      "parentUuid": "1adf8d57_7d901596",
      "range": {
        "startLine": 1062,
        "startChar": 0,
        "endLine": 1062,
        "endChar": 72
      },
      "revId": "2be8ae8b5d69ab2f9950730b0e22ea6f6b8a61bc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1adf8d57_3d05edc1",
        "filename": "templates/scripts/includes/deployment.sh",
        "patchSetId": 1
      },
      "lineNbr": 1062,
      "author": {
        "id": 1000001
      },
      "writtenOn": "2018-11-30T15:41:49Z",
      "side": 1,
      "message": "Sure one line is always better, but...\nwhere is the guaranties 3 seconds is enough? Why not 42?\nIn case of some slow RAID controller card or CPU. Virtualisation? With wait, we can wait up to minutes...",
      "parentUuid": "1adf8d57_fdc9a5ad",
      "range": {
        "startLine": 1062,
        "startChar": 0,
        "endLine": 1062,
        "endChar": 72
      },
      "revId": "2be8ae8b5d69ab2f9950730b0e22ea6f6b8a61bc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1adf8d57_9d1d0112",
        "filename": "templates/scripts/includes/deployment.sh",
        "patchSetId": 1
      },
      "lineNbr": 1062,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2018-11-30T16:41:37Z",
      "side": 1,
      "message": "\u003e Sure one line is always better, but...\n \u003e where is the guaranties 3 seconds is enough? Why not 42?\n \u003e In case of some slow RAID controller card or CPU. Virtualisation?\n \u003e With wait, we can wait up to minutes...\n\nWith the code that you posted there\u0027s a wait of 5s max, so I don\u0027t think that it makes much a difference.\n\nI chose 3 and not 42 because in practice it worked for a while without any wait at all, so I assume that small delays are OK.\n\nBut OK, if we have to wait for longer, polling makes more sense, so I\u0027ll something for that.",
      "parentUuid": "1adf8d57_3d05edc1",
      "range": {
        "startLine": 1062,
        "startChar": 0,
        "endLine": 1062,
        "endChar": 72
      },
      "revId": "2be8ae8b5d69ab2f9950730b0e22ea6f6b8a61bc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1adf8d57_7dc81575",
        "filename": "templates/scripts/includes/deployment.sh",
        "patchSetId": 1
      },
      "lineNbr": 1062,
      "author": {
        "id": 1000001
      },
      "writtenOn": "2018-11-30T17:01:22Z",
      "side": 1,
      "message": "I honestly do not know how long we should wait... normally even 1s is enough... we have too much assumptions already.",
      "parentUuid": "1adf8d57_9d1d0112",
      "range": {
        "startLine": 1062,
        "startChar": 0,
        "endLine": 1062,
        "endChar": 72
      },
      "revId": "2be8ae8b5d69ab2f9950730b0e22ea6f6b8a61bc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    }
  ]
}